# 修改说明

## 日期：2025年10月5日

### 主要更新内容：

1. **外部API支持**：
   - 添加了对外部节假日API的支持，可配置API端点以检查特定地区特定日期是否为节假日
   - 支持使用{date}、{region}、{country}、{language}占位符的URL模板
   - 可配置API密钥（如需要）
   - 支持多种API响应格式
   - 支持多语言节假日名称（包括中文）

2. **CSV上传功能增强**：
   - 保持原有的CSV上传功能
   - CSV上传的日程现在有最高优先级（仅次于外部API）

3. **优先级顺序调整**：
   - 外部API结果（最高优先级）
   - CSV上传日程
   - 预定义节假日日历
   - 周末日程
   - 工作日日程
   - 默认日程（最低优先级）

4. **UI界面现代化**：
   - 更新了节假日配置页面，同时支持API配置和CSV上传
   - 添加了测试API连接功能
   - 改进了页面布局和样式
   - 添加了优先级说明

5. **API端点扩展**：
   - 新增 `is_holiday_external` 端点用于检查外部节假日
   - 新增 `get_current_config` 端点用于获取当前配置
   - 新增 `update_api_config` 端点用于更新API配置

6. **代码优化**：
   - 重构了日历模块以支持外部API
   - 改进了JSON解析和错误处理
   - 优化了调度检查逻辑

### 具体文件变更：

- `luasrc/util/wifischedule/calendar.lua`: 添加API支持和优先级逻辑
- `luasrc/util/wifischedule/api.lua`: 新增API功能
- `luasrc/controller/wifischedule/wifi_schedule.lua`: 更新控制器以支持新功能
- `luasrc/model/cbi/wifischedule/wifi_schedule.lua`: 添加API配置选项
- `luasrc/view/wifischedule/csv_upload.htm`: 重做UI界面
- `README.md`: 更新文档